{{ define "queues" }}
<div>
    <h1>{{.Title}}</h1>
    <table>
        <thead>
            <tr>
                <th>Virtual Host</th>
                <th>Name</th>
                <th>State</th>
                <th>Ready</th>
                <th>Unacked</th>
                <th>Persistent</th>
                <th>Total</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="queues-list">
            <!-- Queues will be populated here -->
        </tbody>
    </table>
    <div>
        <p>Add a new queue</p>
        <form id="add-queue-form">
            <input type="text" id="queue-name" placeholder="Queue Name" required>
            <button type="submit">Add Queue</button>
        </form>
    </div>
    <div id="get-message" style="display: none;">
        <h2>Get Message</h2>
        <p class="warning">Warning: This action is destructive and will remove the message from the queue.</p>
        <form id="get-message-form">
            <input type="hidden" id="selected-queue">
            <button type="submit">Get Message</button>
        </form>
        <div id="message-content" style="display: none;">
            <h3>Message:</h3>
            <pre id="message"></pre>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchQueues();

        document.getElementById('add-queue-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const queueName = document.getElementById('queue-name').value;
            addQueue(queueName);
        });

        document.getElementById('get-message-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const queue = document.getElementById('selected-queue').value;
            getMessage(queue);
        });
    });

    async function fetchQueues() {
        const response = await fetch('/api/queues');
        const data = await response.json();
        const queuesList = document.getElementById('queues-list');
        queuesList.innerHTML = '';
        data.queues.forEach(queue => {
            const row = document.createElement('tr');
            row.onclick = () => selectQueue(queue);
            row.innerHTML = `
                <td>localhost</td>
                <td>${queue}</td>
                <td>running</td>
                <td>0</td>
                <td>0</td>
                <td>0</td>
                <td>0</td>
                <td>
                    <button onclick="deleteQueue('${queue}')">Delete</button>
                </td>
            `;
            queuesList.appendChild(row);
        });
    }

    async function addQueue(name) {
        const response = await fetch('/api/queues', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name})
        });
        if (response.ok) fetchQueues();
    }

    async function deleteQueue(name) {
        const response = await fetch(`/api/queues/${name}`, { method: 'DELETE' });
        if (response.ok) fetchQueues();
    }

    async function getMessage(queue) {
        const response = await fetch(`/api/queues/${queue}/consume`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        });
        if (response.ok) {
            const data = await response.json();
            const messageContent = document.getElementById('message-content');
            messageContent.style.display = 'block';
            document.getElementById('message').textContent = data.message;
        } else {
            console.error('Failed to get message');
        }
    }

    function selectQueue(queue) {
        document.getElementById('selected-queue').value = queue;
        document.getElementById('get-message').style.display = 'block';
    }
</script>
{{ end }}
